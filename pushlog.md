# 3.26

## 上传前端的环境配置

### by 沈刘

### ------------------------------------------

# 3.27 晚

## 任务完成情况：

### 完成登录注册页面。

## 关系设计说明：

### 学号/工号是用户身份唯一标识，而不是用户名。邮箱也不能重复。

## 安全措施：

### 密码已经加密，在 admin 后台只能看到加密后的用户密码（一堆乱码）

### 在.html 文件中加入了{%csrf_token%} 可以防止“跨站请求伪造”

## 待完善的地方：

### 前端：注册和登录页面需要美化。页面上方的导航栏出了点问题。

### 后端：将教师/学生的注册和登录页面分开。

### 设计表格：数据库里要增加 2 张表格：当前预定状态的表格和图书馆 座位情况的表格。

### by 陈欣然

### ------------------------------------------

# 3.28 中午

## 任务完成情况：修复部分无法显示的 bug

### by 沈刘

### ------------------------------------------

# 4.1 中午

## 任务完成情况:

### 完成前端基本界面框架的搭建包括 查询信息、预约座位、续约座位、取消预约 四个模块的初始化工作，具体的实现部分还未完成

### 打开./front/dist/index.html 文件即可查看预览图

### 或者直接用 django 运行项目，在登陆成功后可以查看到预览图，效果图的截图请看 效果图 1.png 和效果图 2.png

### 效果图中两侧有白边框，在以后的更新中解决

### 添加前端的验证

### by 沈刘

### ------------------------------------------

# 4.10 傍晚

## 任务完成情况：

1. 将郑幸锴同学设计的数据库整合到项目中
2. 新建了测试数据文件，详情见 测试数据生成集 文件夹下的 readme.md 文件
3. 整理项目的文档
4. 注意：如果要添加本次更新的新的数据库，需要进行一下操作：删除重新创建 mysql 中的 users 模式，然后删除 \rear\login\migrations 目录下的 除了**init**.py 以外的所有文件，在终端运行一下命令
   ```
   python manage.py makemigrations  #准备迁移
   python manage.py migrate         #数据库迁移
   python manage.py createsuperuser #创建超级用户
   ```
   运行完毕后打开 “测试数据生成集” 文件夹，生成测试数据，然后就可以运行整个项目

#### by 沈刘

# 4.13 晚 -4.14 早

## 任务完成情况：

### 1.在原有基础上修改数据库模型。将 desk 和 rent 放入新的 app 文件夹下。并增加了 floor 类。

## 数据库说明：

### 两个 App 使用的是同一个数据库。

## 尚待讨论商榷的问题：

### 一些外键的使用、约束关系的设置。

### 2.在原有基础上修改测试数据生成文件。生成了 user,desk,floor 类的数据。生成方法同上。

## 说明：

### （1）floor 类有 4 层，每层的最大容量是 25（可以更改）。

### （2）desk 的 id 是它的主码。1-25 号放第一层，26-50 放第二层，以此类推……

### （3）把 Mysqldb 修改未 pymysql。

### MySQLdb 试用于较早期版本，而 pymysql 是新版本。

### 3.尝试写了查询的 view 函数和 base 模板。

### 函数的逻辑可供参考，但需要做一些调整。

## 存在的问题：

### 没有跑通这一部分。希望得到关于 API 实现部分的帮助。

## 说明：

### view.py 调用了一个@api_view ，这里使用了一个叫做 rest-frame 的框架。需要通过 pip install django-rest-swagger 安装

### 安装只需要几秒钟时间。django 版本是 2.0.6.

## 下一步任务：分工写 API 接口

### by 陈欣然

### ------------------------------------------

# 4.15 下午

## 任务完成情况

### 完成 search 接口的开发，search 部分的接口文档如下，前端的同学如果有时间可以尝试写一下

|  实现功能   | 查询图书馆的空位情况 |
|  ----  | ----  |
| 请求体  | http://127.0.0.1:8000/seat/search?No=1 |
| 请求方式  | GET |
| 请求参数  | No (用户账号) |
| 返回格式  | JSON |
| 返回体格式| {status:0;(0代表操作成功且用户已经有了预约记录，1代表操作成功但用户没有预约记录，2代表操作失败) message:[{ desk_number:001 , floor:1},{desk_number:001 , floor:1}];（返回所有的空位信息）rent:{id,user_number_id,desk_number_id,date,start_time,end_time,operate_time,status}（如果有预约记录，返回用户的预约记录，如果没有，返回空值）}|

### 具体实现效果在文件夹 预览图 中可以看到
### 如果数据库有变化可能接口有所变化
### by 沈刘
### ------------------------------------------
### ------------------------------------------

# 4.19 下午

## 任务完成情况

### 完成 rent 接口的开发，修改了部分model的内容
### 如果数据库有变化可能接口有所变化
### by 郑幸锴
### ------------------------------------------

# 4.19 晚上

## 任务完成情况

## 完成 cancel 接口的开发 （view.py）

## 在views.py 注释掉了原来写的get_all_user，看起来应该用不到。rest-frame 框架也用不到了。

## 我在测试数据生成中加入了一个cancel.sql文件，根据姓名，实现某个元组的删除。

### by 陈欣然

### 问题：cancel后端接口还没有和前端相连接，无法验证设计是否完善合理

### --------------------------------------------------

# 4.20晚上

## 任务完成情况

## 完成query reserve 前端界面的开发

## query中还缺少一个v-if判断部分，需要讨论；两个url还有一些问题；因为我是用`npm run dev`编写的，所以还需要跟后端结合验证是否有错。

### by 顾睿

### -----------------------------------

# 4.20 晚

## 任务完成情况

## 早上的情况说明：我后续查询了官方文件，官方给出的python3.8并不适配django2.2.8以下的版本，考虑是降python版本或适当更新django的版本。

## 根据接口文件文件完成renew接口的开发，缺少与前端相连，无法确定合理完善。

## 后续应该还需要继续完善修改。

### by 王玮

### --------------------------------------------------------------

# 4.20 晚

## 任务完成情况

## 在沈刘同学的提醒下，1、model.Rent.objects.creat()中有外键无法插入，取消插入操作，使用updata进行修改end_time。2、由于取消操作存在，进行recordsearch时无法排除取消预约的情况，在查询条件中加入state=0的条件。

## 逻辑还需要进一步完善

### by 王玮

### -----------

# 4.21 晚

## 任务完成情况

## 利用css的bootstrap模板将前端查询界面查询得到的信息以表格形式呈现

### by 顾睿

### --------------------

# 5.1

## 任务完成情况

利用element-ui实现了query界面和reserve界面的部分美化；实现了电影院选座的效果布局；利用el-date-picker美化了预约界面表单；利用el-calendar美化了reserve界面

仍需要解决的问题：

1. query界面搜索功能未实现；根据查询结果换颜色功能仍然不太了解实现原理
2. reserve部分，el-calendar的效果和query部分的el-icon的效果我这边本地都加载不出来，可能因为element-ui的配置问题。
3. 希望通过导入背景图片美化界面

by 顾睿

--------------------

# 5.2

## 任务完成情况

## renew部分借助了郑幸楷同学在预约部分对于已有座位的判断，post的end_time是否在别人已预约的时间内，进行了修改

### by王玮

---



# 5.4

## 任务完成情况

完成了query界面的按颜色显示查询结果的实现；

还存在的小问题：

1. 未注明图例
2. 绿色不够醒目；可以换成别的颜色，或者用CSS样式美化
3. 代码冗余度高，如果js有重载函数等可以考虑重构。
4. 可能数组边界还有些小问题，主要我这边本地的后端接口没有改成返回全部信息的；建议组长检验一下

## by顾睿

---
## 5.7 上午
### 任务完成情况

#### 完成了credit（信誉积分）部分的设计。
####   1· 开启一个新的app。定义了model
####   2· 完成admin的编写。可以在后台进行增删改查
####   3· 在rent 模块中的预约、续约、取消部分，增加了增加和倒扣积分的代码
####       做了简单分类，时长>=5小时，时长>=2的，时长=1的三类。

###  问题：
####   希望前端同学设计一个可以展示所有人信誉积分的页面。
####   希望组长可以测试一下修改后的rent.views.py 。

### 个人后期任务：尝试实现头像上传和详细个人资料完善。完善之后也可以增加积分。

### by 陈欣然

## 五月八日下午

### 实现部分的说明

1. 实现注册自动赋予用户积分

2. 新增以下接口：http://127.0.0.1:8000/credit/getcredit接口获取本人积分的，http://1270.0.1:8000/credit/getall获取积分排名降序排列，http://127.0.0.1:8000/credit/insert用于测试的时候批量生成随机积分，用于生成测试数据

3. 要成功运行后端部分，需要进行一下步骤:     1. 重新数据库迁移     2. 运行测试数据生成集中的 user.py  desk.py   3. 然后在启动项目后在浏览器中输入http://127.0.0.1:8000/credit/insert，即可完成原始数据的生成

4. 完成积分系统的初步设计

   ## by沈刘

   
## 5.10 下午

### 任务完成情况说明：

##### 增加功能：增加注册后邮箱认证功能，未进行确认的用户无法登录。

##### 功能实现说明：向用户注册邮箱发送一封邮件，包含随机生成的验证码。增加confirm页面，在注册完成后，自动跳转到该页面，进行验证码的确认。在user类里新增has_confirmed，默认为false，此时无法登录，需要进行验证。验证码与数据库中记录相匹配，则激活账户，跳转至登录操作。

##### 运行说明：1、需要在setting文件里增加有关邮箱的设置，(我重新申请了一个163邮箱作为发送验证码的邮箱,账号：libraryseat@163.com 密码：sjtusoftwaret8)2、重新数据库迁移

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_USE_TSL = False
EMAIL_HOST = 'smtp.163.com'
EMAIL_PORT = 25
EMAIL_FROM = 'libraryseat@163.com'
EMAIL_HOST_USER = 'libraryseat@163.com'  # 帐号
EMAIL_HOST_PASSWORD = 'TQXGOLHZQGBDQMSN'  # 授权码（****）
DEFAULT_FROM_EMAIL = EMAIL_HOST_USER

##### 问题：
1、是否需要在主页面上也增加一个按钮用于直接进入confirm页面？
2、测试数据需要相应的修改

## by王玮

#### 基本功能全部实现，只剩下美化，准备完结撒花

#### 如果需要运行程序的话需要将根目录下的settiings.py放到mysite下，配置databases选项，然后在终端运行 pip install django-cors-headers 进行数据库迁移就可以了运行了

### by 沈刘

---
## 5.18 上午
### 任务完成情况说明
1. 修改了预约界面的显示问题；修改了查询结果与座位号的对应问题；
### 还存在的问题
1. 查询预约的表格中，座位号与楼层号无法显示，可能因为接口名称的原因。希望后端同学更新一下接口文档。

### by 顾睿

## 5.23上午

### 工作情况：

### 1. 清理项目目录

### 2.完善readme.md

### 3.新增单元测试文件

#### by沈刘



